# ~~Study-Sea-weather-detection-system~~
# Tian Qi De Son

> Study Sea is NOT a fish pond!!!

一个基于`nodemcu`硬件和`lua`语言的气候监测系统，并配合实时在线数据展示。称之为“学海水温侦测系统”。\
[网址在此](http://suours.com/sea)

# 硬件
* nodemcu\
主控芯片，基于`ESP8266`，使用`lua`脚本语言，配合`Esplorer-CN-V0.2.jar`，开发方便。可以直接连接`WiFi`。功耗并没有非常优秀。

* ds18b20\
水温检测模块，单线通信。`nodemcu`对其支持感觉并不好，`51`对其支持都更稳定。使用了两米防水的。精度到小数点后一位。

* bmp180\
气温气压检测模块，使用`I2C`通信。体积小，精度高，很稳定。

* dht11\
气温湿度检测模块，单线通信。温度精度只有整数，主要用湿度数据。比较经典的一个模块。

* GA6-B\
国产`GPRS/GSM`模块，对应`SIM800`系列模块，价格比较美丽。开始炸了两个，后来换了钽电容都修好了。不能使用电信卡，用`TCP`来向服务器发送数据。

# 电源
使用`12V 18650`电池组。 \
`6V 15W`太阳能板提供长时间工作所需电能。\
太阳能电池板 `6V` -> 18650电池组 `12V` -> `nodemcu`&`GA6-B` `5V` -> `nodemcu`输出各类硬件 `3.3V`

# 引脚
* 水温：`Pin 5`
* 气温气压：`SCL:Pin 1`、 `SDA:Pin 2`
* 温度湿度：`Pin 6`
* 短接`RST`和`Pin 0`获得深度睡眠唤醒能力。

# 线上
后端是一个`python`脚本，监听`2333`端口的`TCP`并进行通信。获得数据后直接写入一个`data.js`文件（以定义`js`变量的方式，这样前端表格就可以直接使用）。\
前端用了`ECharts`实现交互式的图表显示。

## 线上api
`data.js`文件中是一个`json`格式的字典，每个键对应一个列表，列表中的每个元素一一对应（时间戳一致），其中几参数如下。
* date 时间戳。其中元素示例`'2019-12-22 21:30:35'`。
* tmp0 `ds18b20`水温。其中元素示例`["2019-12-22 21:30:35","19.3"]`
* tmp1 `dht11`温度。其中元素示例`["2019-12-22 21:30:35","28"]`
* tmp2 `bmp180`温度。其中元素示例`["2019-12-22 21:30:35","28.9"]`
* humi `dht11`湿度。其中元素示例`["2019-12-22 21:30:35","28"]`
* pres `bmp11`气压。其中元素示例`["2019-12-22 21:30:35","80574"]`

`now.js`也是一样的，只不过每个键直接对应元素，和`data.js`每个列表的最后一个元素一致。

# 日志
本来使用`WiFi`来着，今天把`GSM`部分写了，创建仓库。

@2020-02-0
